def MAVEN_PROFILE = ""

pipeline {
  agent any
//  agent {
//    docker {
//      image 'maven:3-alpine'
//      args '-v /Users/mworthington/.m2:/root/.m2'
//    }
//  }

  tools {
    maven 'Maven 3.5.3 - Local Install'
  }

  options {
    timestamps()
  }

//  parameters {
//    string (name: 'Greeting', defaultValue: 'Hello', description: 'How should I greet the world?')
//  }
//
//  environment {
//  }

  stages {
    stage('Prep') {
      steps {
        input 'Move Image into QA?'

        configFileProvider([configFile(fileId: 'c53477b4-afad-4fe1-89e7-b1c28e899e4e', variable: 'MAVEN_SETTINGS')]) {

          script {
            echo "Setting maven profile"
            MAVEN_PROFILE="-P staging-release"
          }


//          curl -X PUT \
//  http://localhost:8083/nexus/service/rest/v1/tags/CNB \
//  -H 'Content-Type: application/json' \
//  -d '{
//          "attributes": {
//            "docker": "build",
//            "additionalProp2": {
//              "whydoesthistagexist": "because i want to test staging with snapshots",
//              "who'\''s on first": "what'\''s on second"
//            },
//            "additionalProp3": {}
//          }
//        }'


          //curl -X PUT "http://localhost:8083/nexus/service/rest/v1/tags/RBCDemoJenkinsfile-51" -H "accept: application/json" -H "Content-Type: application/json" -d "{ \"attributes\": { \"additionalProp1\": \"a\", \"additionalProp2\": \"b\", \"additionalProp3\": \"c\"}"

          //                      requestBody: '''{
//"attributes": {
//    "333333": "IQIQIQIQIQIQIQIQIQIQI",
//    "jenkinsJob": ${BUILD_URL}
//  }
//}''',



          httpRequest acceptType: 'APPLICATION_JSON',
                      authentication: 'nexus-iq-demo',
                      consoleLogResponseBody: true,
                      contentType: 'APPLICATION_JSON',
                      httpMode: 'PUT',
                      requestBody: '{ "attributes": {' +
                              '"user" : "' + "mike" + '",' +
                              '"jenkinsJob": "' + "${BUILD_URL}" + '"' +
                              '} }',
                      responseHandle: 'NONE',
                      url: 'http://localhost:61446/nexus/service/rest/v1/tags/RBCDemoJenkinsfile-51',
                      validResponseCodes: '200'


        }
      }
    }
//    stage('Greeting') {
//      when {
//        equals expected: "Hello", actual: params.Greeting
//      }
//      steps {
//        echo "An Extra Special Greeting!!!!"
//
//        echo "MAVEN_PROFILE: ${MAVEN_PROFILE}"
//        withEnv(["MAVEN_PROFILE=${MAVEN_PROFILE}"]) {
//          sh 'echo "MAVEN_PROFILE = ${MAVEN_PROFILE}"'
//        }
//      }
//    }
  }
}